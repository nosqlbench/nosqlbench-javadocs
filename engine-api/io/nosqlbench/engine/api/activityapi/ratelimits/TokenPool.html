<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (12.0.2) on Fri Mar 13 23:19:09 UTC 2020 -->
<title>TokenPool (nosqlbench)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2020-03-13">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../../jquery/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../../../../../../jquery/jquery-migrate-3.0.1.js"></script>
<script type="text/javascript" src="../../../../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="TokenPool (nosqlbench)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TokenPool.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">io.nosqlbench.engine.api.activityapi.ratelimits</a></div>
<h2 title="Class TokenPool" class="title">Class TokenPool</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>io.nosqlbench.engine.api.activityapi.ratelimits.TokenPool</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre>public class <span class="typeNameLabel">TokenPool</span>
extends java.lang.Object</pre>
<div class="block"><h2>Synopsis</h2>

 This TokenPool represents a finite quantity which can be
 replenished with regular refills. Extra tokens that do not fit
 within the active token pool are saved in a waiting token pool and
 used to backfill when allowed according to the backfill rate.

 A detailed explanation for how this works will be included
 at @link "http://docs.nosqlbench.io/" under dev notes.

 <p>This is the basis for the token-based rate limiters in
 NB. This mechanism is easily adaptable to bursting
 capability as well as a degree of stricter timing at speed.
 Various methods for doing this in a lock free way were
 investigated, but the intrinsic locks provided by synchronized
 method won out for now. This may be revisited when EB is
 retrofitted for J11.
 </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<div class="memberSummary">
<table>
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Field</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><code>static double</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#MIN_CONCURRENT_OPS">MIN_CONCURRENT_OPS</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</section>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<div class="memberSummary">
<table>
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(long,double)">TokenPool</a></span>&#8203;(long&nbsp;poolsize,
         double&nbsp;burstRatio)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(io.nosqlbench.engine.api.activityapi.ratelimits.RateSpec)">TokenPool</a></span>&#8203;(<a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits">RateSpec</a>&nbsp;rateSpec)</code></th>
<td class="colLast">
<div class="block">This constructor tries to pick reasonable defaults for the token pool for
 a given rate spec.</div>
</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<div class="memberSummary">
<div role="tablist" aria-orientation="horizontal"><button role="tab" aria-selected="true" aria-controls="memberSummary_tabpanel" tabindex="0" onkeydown="switchTab(event)" id="t0" class="activeTableTab">All Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t2" class="tableTab" onclick="show(2);">Instance Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t4" class="tableTab" onclick="show(8);">Concrete Methods</button></div>
<div id="memberSummary_tabpanel" role="tabpanel">
<table aria-labelledby="t0">
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor" id="i0">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#apply(io.nosqlbench.engine.api.activityapi.ratelimits.RateSpec)">apply</a></span>&#8203;(<a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits">RateSpec</a>&nbsp;rateSpec)</code></th>
<td class="colLast">
<div class="block">Change the settings of this token pool, and wake any blocked callers
 just in case it allows them to proceed.</div>
</td>
</tr>
<tr class="rowColor" id="i1">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#blockAndTake()">blockAndTake</a></span>()</code></th>
<td class="colLast">
<div class="block">wait for the given number of tokens to be available, and then remove
 them from the pool.</div>
</td>
</tr>
<tr class="altColor" id="i2">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#blockAndTake(long)">blockAndTake</a></span>&#8203;(long&nbsp;tokens)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i3">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getActivePool()">getActivePool</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i4">
<td class="colFirst"><code>double</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getBurstRatio()">getBurstRatio</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i5">
<td class="colFirst"><code><a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits">RateSpec</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getRateSpec()">getRateSpec</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i6">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getWaitPool()">getWaitPool</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i7">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getWaitTime()">getWaitTime</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i8">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#refill(long)">refill</a></span>&#8203;(long&nbsp;newTokens)</code></th>
<td class="colLast">
<div class="block">Add the given number of new tokens to the pool, forcing any amount
 that would spill over the current pool size into the wait token pool, but
 moving up to the configured burst tokens back from the wait token pool
 otherwise.</div>
</td>
</tr>
<tr class="rowColor" id="i9">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#restart()">restart</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i10">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#takeUpTo(long)">takeUpTo</a></span>&#8203;(long&nbsp;amt)</code></th>
<td class="colLast">
<div class="block">Take tokens up to amt tokens form the pool and report
 the amount of token removed.</div>
</td>
</tr>
<tr class="rowColor" id="i11">
<td class="colFirst"><code>java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#toString()">toString</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a id="MIN_CONCURRENT_OPS">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>MIN_CONCURRENT_OPS</h4>
<pre>public static final&nbsp;double MIN_CONCURRENT_OPS</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#io.nosqlbench.engine.api.activityapi.ratelimits.TokenPool.MIN_CONCURRENT_OPS">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;(io.nosqlbench.engine.api.activityapi.ratelimits.RateSpec)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>TokenPool</h4>
<pre>public&nbsp;TokenPool&#8203;(<a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits">RateSpec</a>&nbsp;rateSpec)</pre>
<div class="block">This constructor tries to pick reasonable defaults for the token pool for
 a given rate spec. The active pool must be large enough to contain one
 op worth of time, and the burst ratio</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>rateSpec</code> - a <a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits"><code>RateSpec</code></a></dd>
</dl>
</li>
</ul>
<a id="&lt;init&gt;(long,double)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TokenPool</h4>
<pre>public&nbsp;TokenPool&#8203;(long&nbsp;poolsize,
                 double&nbsp;burstRatio)</pre>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="apply(io.nosqlbench.engine.api.activityapi.ratelimits.RateSpec)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>apply</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;apply&#8203;(<a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits">RateSpec</a>&nbsp;rateSpec)</pre>
<div class="block">Change the settings of this token pool, and wake any blocked callers
 just in case it allows them to proceed.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>rateSpec</code> - The rate specifier.</dd>
</dl>
</li>
</ul>
<a id="getBurstRatio()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getBurstRatio</h4>
<pre class="methodSignature">public&nbsp;double&nbsp;getBurstRatio()</pre>
</li>
</ul>
<a id="takeUpTo(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>takeUpTo</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;takeUpTo&#8203;(long&nbsp;amt)</pre>
<div class="block">Take tokens up to amt tokens form the pool and report
 the amount of token removed.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>amt</code> - tokens requested</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>actual number of tokens removed, greater to or equal to zero</dd>
</dl>
</li>
</ul>
<a id="blockAndTake()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>blockAndTake</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;blockAndTake()</pre>
<div class="block">wait for the given number of tokens to be available, and then remove
 them from the pool.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the total number of tokens untaken, including wait tokens</dd>
</dl>
</li>
</ul>
<a id="blockAndTake(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>blockAndTake</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;blockAndTake&#8203;(long&nbsp;tokens)</pre>
</li>
</ul>
<a id="getWaitTime()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getWaitTime</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;getWaitTime()</pre>
</li>
</ul>
<a id="getWaitPool()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getWaitPool</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;getWaitPool()</pre>
</li>
</ul>
<a id="getActivePool()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getActivePool</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;getActivePool()</pre>
</li>
</ul>
<a id="refill(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>refill</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;refill&#8203;(long&nbsp;newTokens)</pre>
<div class="block">Add the given number of new tokens to the pool, forcing any amount
 that would spill over the current pool size into the wait token pool, but
 moving up to the configured burst tokens back from the wait token pool
 otherwise.

 The amount of backfilling that occurs is controlled by the backfill ratio,
 based on the number of tokens submitted. This causes normalizes the
 backfilling rate to the fill rate, so that it is not sensitive to refill
 scheduling.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>newTokens</code> - The number of new tokens to add to the token pools</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the total number of tokens in all pools</dd>
</dl>
</li>
</ul>
<a id="toString()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>toString</h4>
<pre class="methodSignature">public&nbsp;java.lang.String&nbsp;toString()</pre>
<dl>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code>toString</code>&nbsp;in class&nbsp;<code>java.lang.Object</code></dd>
</dl>
</li>
</ul>
<a id="getRateSpec()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRateSpec</h4>
<pre class="methodSignature">public&nbsp;<a href="RateSpec.html" title="class in io.nosqlbench.engine.api.activityapi.ratelimits">RateSpec</a>&nbsp;getRateSpec()</pre>
</li>
</ul>
<a id="restart()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>restart</h4>
<pre class="methodSignature">public&nbsp;long&nbsp;restart()</pre>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TokenPool.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &#169; 2020. All rights reserved.</small></p>
</footer>
</body>
</html>
